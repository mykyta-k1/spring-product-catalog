<!DOCTYPE html>
<html lang="uk" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Продукти</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
        rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
        rel="stylesheet"/>
  <link
    href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css"
    rel="stylesheet"/>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="/api/v2/categories">My Shop</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="/api/v2/categories">Головна</a></li>
        <li class="nav-item"><a class="nav-link active" href="/api/v2/products">Продукти</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container-fluid mt-4">
  <div class="row">

    <!-- Ліва панель фільтрів -->
    <div class="col-md-3">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Фільтри</h5>
        </div>
        <div class="card-body">
          <form method="get" action="/api/v2/products">

            <!-- Пошук за ключовим словом -->
            <div class="mb-3">
              <label class="form-label fw-bold">Пошук</label>
              <input type="text" class="form-control" name="keyword"
                     th:value="${param.keyword}" placeholder="Назва продукту...">
            </div>

            <!-- Ціна -->
            <div class="mb-3">
              <label class="form-label fw-bold">Ціна</label>
              <div class="row g-2">
                <div class="col-6">
                  <input type="number" class="form-control form-control-sm"
                         name="minPrice" th:value="${param.minPrice}"
                         placeholder="Від" step="0.01">
                </div>
                <div class="col-6">
                  <input type="number" class="form-control form-control-sm"
                         name="maxPrice" th:value="${param.maxPrice}"
                         placeholder="До" step="0.01">
                </div>
              </div>
            </div>

            <div class="db-3">
              <label class="form-label fw-bold">Сортування за</label>
              <select name="sort" class="form-select form-select-sm">
                <option value="">Без сортування</option>
                <option value="price=asc" th:selected="${param.sort == 'price=asc'}">Від дешевих до
                  дорогих
                </option>
                <option value="price=desc" th:selected="${param.sort == 'price=desc'}">Від дорогих
                  до дешевих
                </option>
                <option value="category=asc" th:selected="${param.sort == 'category=asc'}">За
                  категорією
                </option>
              </select>
            </div>
/products
            <!-- В наявності -->
            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input"
                     name="inStock" th:checked="${param.inStock}"
                     id="inStockCheck">
              <label class="form-check-label" for="inStockCheck">
                Тільки в наявності
              </label>
            </div>

            <!-- Категорії -->
            <div class="mb-3">
              <label class="form-label fw-bold">Категорії</label>
              <select class="form-select form-select-sm" name="categoryIds" multiple size="4">
                <option th:each="category : ${categories}"
                        th:if="${category.parentId != null}"
                        th:value="${category.id()}"
                        th:text="${category.name()}">
                </option>
              </select>
              <small class="text-muted">Утримуйте Ctrl для множинного вибору</small>
            </div>

            <!-- Бренди -->
            <div class="mb-3">
              <label class="form-label fw-bold">Бренди</label>
              <select class="form-select form-select-sm" name="brandIds" multiple size="4">
                <option th:each="brand : ${brands}"
                        th:value="${brand.id()}"
                        th:text="${brand.name()}">
                </option>
              </select>
            </div>

            <!-- Типи продуктів -->
            <div class="mb-3">
              <label class="form-label fw-bold">Тип продукту</label>
              <select class="form-select form-select-sm" name="productTypeIds" multiple size="4">
                <option th:each="productType : ${productTypes}"
                        th:value="${productType.id()}"
                        th:text="${productType.name()}">
                </option>
              </select>
            </div>

            <!-- Вага -->
            <div class="mb-3">
              <label class="form-label fw-bold">Вага (грам)</label>
              <div class="row g-2">
                <div class="col-6">
                  <input type="number" class="form-control form-control-sm"
                         name="minWeight" th:value="${param.minWeight}"
                         placeholder="Від">
                </div>
                <div class="col-6">
                  <input type="number" class="form-control form-control-sm"
                         name="maxWeight" th:value="${param.maxWeight}"
                         placeholder="До">
                </div>
              </div>
            </div>

            <!-- Кнопки -->
            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary">Застосувати</button>
              <a href="/api/v2/products" class="btn btn-outline-secondary">Скинути</a>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Права частина - список продуктів -->
    <div class="col-md-9">

      <!-- Інфо про результати -->
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Продукти</h4>
        <span class="text-muted" th:if="${listProducts != null}">
                    Показано <strong th:text="${listProducts.numberOfElements}"></strong>
                    з <strong th:text="${listProducts.totalElements}"></strong>
                </span>
      </div>

      <!-- Сітка продуктів -->
      <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 row-cols-xl-4 g-4">
        <div class="col" th:each="product : ${listProducts.content}">
          <div class="card h-100 shadow-sm">
            <a th:href="@{/api/v2/products/{slug}(slug=${product.slug})}" class="text-decoration-none">
              <img th:src="${product.imageUrl}"
                   class="card-img-top"
                   th:alt="${product.name}"
                   style="height: 200px; object-fit: cover;">
              <div class="card-body">
                <h6 class="card-title text-dark" th:text="${product.name}"></h6>
                <p class="card-text text-primary fw-bold mb-0">
                  $ <span th:text="${product.price}"></span>
                </p>
              </div>
            </a>
            <div class="card-footer bg-transparent border-0">
              <a th:href="@{/api/v2/products/{slug}(slug=${product.slug})}"
                 class="btn btn-sm btn-outline-primary w-100">
                Детальніше
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Повідомлення якщо немає результатів -->
      <div th:if="${listProducts.empty}" class="alert alert-info mt-4">
        <i class="bi bi-info-circle"></i> Продуктів не знайдено. Спробуйте змінити фільтри.
      </div>

      <!-- Пагінація -->
      <nav th:if="${listProducts.totalPages > 1}" class="mt-4" aria-label="Пагінація продуктів">
        <ul class="pagination justify-content-center">

          <!-- Попередня сторінка -->
          <li class="page-item" th:classappend="${!listProducts.hasPrevious()} ? 'disabled'">
            <a class="page-link"
               th:href="@{/api/v2/products(page=${listProducts.number - 1}, size=${listProducts.size})}">
              Назад
            </a>
          </li>

          <!-- Номери сторінок -->
          <li class="page-item"
              th:each="i : ${#numbers.sequence(0, listProducts.totalPages - 1)}"
              th:classappend="${i == listProducts.number} ? 'active'">
            <a class="page-link"
               th:href="@{/api/v2/products(page=${i}, size=${listProducts.size})}"
               th:text="${i + 1}"></a>
          </li>

          <!-- Наступна сторінка -->
          <li class="page-item" th:classappend="${!listProducts.hasNext()} ? 'disabled'">
            <a class="page-link"
               th:href="@{/api/v2/products(page=${listProducts.number + 1}, size=${listProducts.size})}">
              Вперед
            </a>
          </li>
        </ul>
      </nav>

    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
  $(document).ready(function () {
    $('select[multiple]').select2({
      theme: 'bootstrap-5',
      placeholder: 'Виберіть опції',
      allowClear: true,
      closeOnSelect: false
    });
  });
</script>
</body>
</html>
